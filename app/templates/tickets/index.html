{% extends "base.html" %}

{% block content %}
<div class="flex items-center justify-between">
  <h1 class="text-2xl font-bold">Support Tickets</h1>
  <a class="text-blue-500 hover:underline" href="{{ url_for('tickets.index') }}">Refresh</a>
</div>

<div class="my-4">
  <h2 class="text-xl font-semibold">Create Ticket</h2>
  <form method="POST" action="{{ url_for('tickets.index') }}">
    {{ form.hidden_tag() }}
    <div class="mb-3">{{ form.subject.label(class="block text-sm font-medium") }} {{ form.subject(class="w-full border rounded px-3 py-2") }}</div>
    <div class="mb-3">{{ form.description.label(class="block text-sm font-medium") }} {{ form.description(class="w-full border rounded px-3 py-2") }}</div>
    <div class="mb-3">{{ form.priority.label(class="block text-sm font-medium") }} {{ form.priority(class="border rounded px-2 py-1") }}</div>
    {{ form.submit(class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded") }}
  </form>
</div>

<h2 class="text-xl font-semibold mt-8">My Organization's Tickets</h2>
<form method="GET" action="{{ url_for('tickets.index') }}" class="flex items-end gap-2 mt-2">
  <div>
    <label class="block text-sm font-medium">Status</label>
    <select name="status" class="border rounded px-2 py-1">
      <option value="">All</option>
      {% for s in ['new','open','pending','resolved','closed'] %}
        <option value="{{ s }}" {% if request.args.get('status') == s %}selected{% endif %}>{{ s|title }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label class="block text-sm font-medium">Priority</label>
    <select name="priority" class="border rounded px-2 py-1">
      <option value="">All</option>
      {% for p in ['low','normal','high','urgent'] %}
        <option value="{{ p }}" {% if request.args.get('priority') == p %}selected{% endif %}>{{ p|title }}</option>
      {% endfor %}
    </select>
  </div>
  <button class="h-9 px-3 bg-slate-700 hover:bg-slate-800 text-white rounded">Filter</button>
  <a href="{{ url_for('tickets.index') }}" class="h-9 px-3 inline-flex items-center bg-slate-200 dark:bg-slate-700 rounded">Clear</a>
  </form>
{% if tickets %}
  <div class="mt-2 divide-y divide-slate-200 dark:divide-slate-700">
    {% for t in tickets %}
      <div class="py-3 flex items-start justify-between">
        <div>
          <a href="{{ url_for('tickets.view', ticket_id=t.id) }}" class="font-medium text-blue-600 hover:underline">#{{ t.id }} — {{ t.subject }}</a>
          <div class="text-sm text-slate-600 dark:text-slate-300">Priority: {{ t.priority }} • Status: {{ t.status }} • Assigned: {{ t.assigned_to.email if t.assigned_to else '—' }} • {{ t.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p class="text-slate-600">No tickets yet.</p>
{% endif %}
{% endblock %}
